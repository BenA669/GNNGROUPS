import numpy as np
from sklearn.linear_model import LinearRegression

nasdaq_2000_values = [
    3834.44, 3711.09, 4002.23, 4031.38, 3950.95, 3915.14, 4045.72, 4059.65,
    4116.27, 4205.06, 4236.65, 4290.38, 4124.75, 4174.72, 4120.5, 4010.14,
    3873.84, 3961.07, 4059.03, 4134.65, 4242.15, 4274.03, 4370.01, 4460.18,
    4390.16, 4489.33, 4434.38, 4415.52, 4427.19, 4483.01, 4563.72, 4432.83,
    4406.88, 4583.89, 4618.83, 4575.07, 4646.64, 4732.82, 4816.81, 4846.01,
    4935.65, 4991.97, 4920.86, 4913.08, 5060.34, 4879.03, 4997.31, 4758.44,
    4658.44, 4702.03, 4812.14, 4589.52, 4750.54, 4874.17, 4986.54, 4994.42,
    4939.05, 4860.02, 4540.44, 4550.21, 4494.89, 4283.45, 4025.9, 4266.8,
    4354.13, 4475.2, 4094.61, 4050.32, 3839.56, 3597.44, 3232.94, 3596.15,
    3832.65, 3735.08, 3466.69, 3592.73, 3728.99, 3519.13, 3830.61, 3930.18,
    3927.92, 3755.3, 3723.27, 3694.28, 3758.46, 3704.85, 3525.02, 3450.06,
    3546.24, 3533.21, 3674.89, 3649.54, 3660.24, 3480.63, 3390.95, 3346.66,
    3155.14, 3308.51, 3215.28, 3286.54, 3428.25, 3471.95, 3728.95, 3773.24,
    3825.98, 3766.55, 3886.04, 3892.75, 3892.05, 3743.91, 3875.04, 3802.19,
    3877.07, 3818.65, 4003.09, 3965.37, 4073.73, 3950.05, 3884.65, 3904.4,
    3877.77, 3900.29, 3889.51, 3950.59, 3949.76, 3872.91, 3978.38, 3993.62,
    3970.42, 4024.59, 4128.81, 4221.8, 4243.55, 4233.49, 4154.37, 4106.63,
    4154, 4109.65, 4015.41, 3998.03, 3938.14, 3855.1, 3692.43, 3760.95,
    3684.12, 3554.68, 3812.31, 3819.38, 3850.87, 3915.26, 3843.58, 3741.62,
    3804.69, 3846.83, 3878.58, 3858.88, 3958.7, 3966.23, 3970.16, 3935.51,
    4020.99, 4049.84, 4049.18, 4074.21, 4076.5, 4127.19, 4252.15, 4205.94,
    4136.84, 4047.02, 4081.96, 3961.16, 3925.42, 3794.92, 3963.1, 3905.09,
    3838.63, 3766.04, 3863.08, 3864.6, 3616.16, 3852.53, 3762.65, 3740.62,
    3638.94, 3749.27, 3714.48, 3624.93, 3440.6, 3499.96, 3477.7, 3352.15,
    3326.89, 3152.33, 3241.26, 3054.55, 3315.48, 3335.4, 3106.95, 3330.25,
    3402.96, 3483.38, 3495.45, 3347.24, 3245.4, 3320.69, 3243.88, 3223.44,
    3316.51, 3387.28, 3447.32, 3469.35, 3399.28, 3426.29, 3174.9, 3122.11,
    2956.09, 3069.81, 3137.61, 3121.8, 3044.45, 2943.11, 2892.03, 2828.14,
    2823.48, 2979.93, 2873.73, 2748.18, 2599.04, 2644.09, 2662.56, 2702.72,
    2878.87, 2748.29, 2857.93, 2936.6, 2994.06, 2996.57, 2820.48, 2688.66,
    2698.72, 2617.06, 2410.96, 2310.21, 2397.67, 2518.29, 2471.33, 2517.9,
    2552.68
]

nasdaq_2001_values = [
    2474.16, 2254.56, 2593.96, 2573.11, 2388.72, 2424.69, 2392.71, 2495.59,
    2639.56, 2631.49, 2710.53, 2696.74, 2838.36, 2759.1, 2759.26, 2850.74,
    2836.35, 2705.39, 2757.29, 2845.01, 2848.11, 2771.57, 2782.93, 2639.65,
    2641.91, 2615.94, 2625.78, 2542.24, 2458.65, 2510.84, 2437.68, 2536.63,
    2444.6, 2439.57, 2281.79, 2272.13, 2221.27, 2287.88, 2286.64, 2223.88,
    2126.3, 2111.23, 2142.75, 2204.3, 2241.23, 2211.3, 2124.11, 2001.68,
    1948.7, 1948.56, 2023.79, 1914.58, 1901.45, 1964.45, 1862.74, 1845.34,
    1938.91, 1957.71, 1922.7, 1925.3, 1838.44, 1830.42, 1835.22, 1758.18,
    1668.37, 1709.91, 1756.11, 1739.66, 1771.68, 1929.93, 1881.19, 1934.7,
    1872.35, 2005.06, 2100.88, 2171.9, 2118.36, 2055.32, 2013.42, 2086.04,
    2070.24, 2113.11, 2116.24, 2205.25, 2183.07, 2102.61, 2194.04, 2209.01,
    2162.3, 2195.52, 2130.74, 2105.36, 2086.98, 2067.6, 2170.01, 2182.56,
    2201.45, 2319.18, 2299.75, 2250.04, 2281.18, 2239.92, 2136.95, 2092.53,
    2131.12, 2164.7, 2167.31, 2239.86, 2208.03, 2263.75, 2205.41, 2133.56,
    2175.62, 2100.74, 2017.8, 2035.34, 2046.04, 1974.11, 2026.3, 2062,
    2054.34, 2022.86, 2068.29, 2096.88, 2129.89, 2156.76, 2137.1, 2122.89,
    2060.73, 2010.97, 2043.61, 1954.72, 2033.22, 2068.22, 2078.53, 2017.47,
    2035.09, 2042.32, 2015.23, 2043.84, 1980.37, 1962.68, 1980.03, 2020.58,
    2034.11, 2023.97, 2051.56, 2092.52, 2079.15, 2047.86, 2026.84, 2015.75,
    1962.48, 1957.34, 1963.04, 1990.83, 1964.2, 1899.9, 1895.42, 1866.29,
    1883.44, 1851.75, 1857.52, 1863.32, 1912.7, 1912.67, 1875.44, 1817.19,
    1784.26, 1802.29, 1771.75, 1736.2, 1694.02, 1673.78, 1613.83, 1591.77,
    1560.52, 1494.94, 1395.79, 1459.47, 1505.52, 1514.76, 1456.8, 1472.56,
    1491.45, 1479.01, 1479.27, 1602.6, 1586.4, 1582.93, 1604.11, 1563.96,
    1649.55, 1690.21, 1684.04, 1704.75, 1752.94, 1648.69, 1644.49, 1666.08,
    1720.54, 1707.52, 1708.49, 1763.78, 1763.42, 1682.3, 1690.12, 1705.52,
    1741.37, 1768.29, 1786.92, 1821.04, 1855.68, 1824.73, 1826.25, 1871.47,
    1910.45, 1891.36, 1903.48, 1912.48, 1926.47, 1873.6, 1878.91, 1914.53,
    1931.59, 1921.6, 1898.63, 1929.29, 1915.13, 1917.66, 1980.3, 2045.22,
    2043.68, 2007.67, 2009.93, 2007.48, 1979.84, 1945.18, 1950.94, 1998.36,
    1981.65, 1969, 1941.55, 1946.84, 1948.77, 1967.32, 1985.71, 1984.31
]

def makeDataset(data):
    data = np.array(data)
    X = []
    y = []

    for t in range(3, len(data)):
        X.append([
            data[t-1],
            data[t-2],
            data[t-3]
        ])
        y.append(data[t])
    X = np.array(X)
    y = np.array(y)

    return X, y

def compute_mse(target, evidence, coefs):
    predictions = target @ coefs
    mse = np.mean((evidence - predictions)**2)
    return mse

target_2000, evidence_2000 = makeDataset(nasdaq_2000_values)
target_2001, evidence_2001 = makeDataset(nasdaq_2001_values)

model = LinearRegression(fit_intercept=False)
model.fit(target_2000, evidence_2000)
coefficients = model.coef_

print("Coefficients")
print(coefficients)

mse_2000 = compute_mse(target_2000, evidence_2000, coefficients)
mse_2001 = compute_mse(target_2001, evidence_2001, coefficients)

print(mse_2000, mse_2001)
